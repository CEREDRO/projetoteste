<div class="panel panel-default pointer">
	<div class="panel-heading">
		<div class="row-fluid">
			<div class="span6">
				<h3 class="panel-title"><i class="icon-list-alt" title="Exibir as avalia&ccedil;&otilde;es efetuadas"></i> Consulta Avalia&ccedil;&atilde;o</h3>
			</div> 
			<div class="span6" id="divhideexibeCancelamento">
				<div class="pull-right pointer">
					<select id="exibeAvalCanc" style="margin-bottom: -18px;">
						<option value="1">Ativas</option>
						<option value="2">Vencidas / Canceladas</option>
						<option value="3">Base Hist&oacute;rica</option>
					</select>
				</div>
			</div>
		</div>
	</div>
	<div class="collapse" id="consultaAvaliacao">
		<div class="panel-body">
			<table class="table table-condensed table-hover">
				<thead>
					<tr>
						<th>#</th>
						<th>Avalia&ccedil;&otilde;es</th>
						<th class="text-center">Data</th>
						<th class="text-center">Validade</th>
						<th class="text-center">N&deg; Avalia&ccedil;&atilde;o</th>
						<th class="text-center">Produto</th>
						<th class="text-center">A&ccedil;&otilde;es</th>
					</tr>
				</thead>
				<tbody>
					<% 	function strToDate(value){
							if (value != null){
								return value.substring(8,10) + "/" + value.substring(5,7) + "/" + value.substring(0, 4);
							}else{
								return value;
							}
						}
						function getDate(){
							return new Date();
						}
						function validaData(value){
							if (value != null){
								var data = new Date(value);
								data.setDate(data.getDate() + 1);
								data.setHours(0);
								if (data >= getDate()){
									return 1;
								}else{
									return 0;
								}
							}else{
								return 0;
							}
						}
						collection.each(function(model){
						
						if (model.get('modeloAvaliacao').restricaoVisualizacao == null) { %>
							<tr class="text-error">
						<% }else if (model.get('indicaBloqueado') == 1 || model.get('indicaBloqueioTomador') == "S"){ %>
							<tr class="text-warning">
						<% }else if (model.get('indicaAutomatica') == "S" && validaData(model.get('dataValidade')) == 1 && model.get('situacao') == 3 && model.get('dataCancelamento') == null){ %>
							<tr class="text-info">
						<% }else if (validaData(model.get('dataValidade')) == 1 && model.get('situacao') == 3 && model.get('dataCancelamento') == null){ %>
							<tr class="text-success">
						<% } else{ %>
							<tr>
						<% }%>
							<% if(model.get('situacao') == 3){ %>
								<td><img src="layout/img/semaforoverde.png" title="Avalia&ccedil;&atilde;o Concluida" class="detalhe-avaliacao" data-codigo="<%= model.get('codigo') %>"/></td>
							<% } else if(model.get('situacao') == 2) { %>
								<td><img src="layout/img/semaforoamarelo.png" title="Avalia&ccedil;&atilde;o em processamento" class="detalhe-avaliacao" data-codigo="<%= model.get('codigo') %>"/></td>
							<% } else if(model.get('situacao') == 1) {%>
								<td><img src="layout/img/SemaforoVermelho.png" title="Avalia&ccedil;&atilde;o Solicitada" class="detalhe-avaliacao" data-codigo="<%= model.get('codigo') %>"/></td>
							<% } else {%>
								<td></td>
							<% } %>
							<td class="detalhe-avaliacao" data-codigo="<%= model.get('codigo') %>"> <%= model.get('modeloAvaliacao').denominacao %> </td>
							<td class="text-center detalhe-avaliacao" data-codigo="<%= model.get('codigo') %>"><%= strToDate(model.get('data')) %></td>
							<% if(model.get('dataValidade') != null){ %>
								<td class="text-center detalhe-avaliacao" data-codigo="<%= model.get('codigo') %>"><%= strToDate(model.get('dataValidade')) %></td>
							<% }else{ %>
								<td class="text-center detalhe-avaliacao" data-codigo="<%= model.get('codigo') %>">00/00/0000</td>
							<% } %>
							<td class="text-center detalhe-avaliacao" data-codigo="<%= model.get('codigo') %>"><%= model.get('codigo') %></td>
							<td class="text-center detalhe-avaliacao" data-codigo="<%= model.get('codigo') %>"><%= model.get('produto') %></td>
							<td class="text-center">
								<% if(model.get('indicaImprime') == 1 && model.get('situacao') == 3){ %>
									<img src="layout/img/PRNPAPER.png" title="Abrir relat&oacute;rio" class="relatorio-avaliacao" data-codigo="<%= model.get('codigo') %>"/>
								<% } if(model.get('indicaCancela') == 1 && model.get('situacao') == 3 && model.get('dataCancelamento') == null) { %>
									<img src="layout/img/canc_aval.png" title="Cancelar avalia&ccedil;&atilde;o" class="cancela-avaliacao" data-codigo="<%= model.get('codigo') %>"/>
								<% } if(model.get('indicaCancela') == 1 && model.get('dataCancelamento') != null && model.get('situacao') == 3) { %>
									<img src="layout/img/cancelada.png" title="Avalia&ccedil;&atilde;o cancelada"/>
								<% } if(model.get('indicaLibera') == '1' && model.get('indicaBloqueado') == 1) { %>
									<img src="layout/img/alcada.png" title="Desbloquear al&ccedil;ada" class="alcada-avaliacao" data-codigo="<%= model.get('codigo') %>"/>
								<% } if(model.get('indicaBloqueado') != 1 && model.get('usuarioDesbloqueio') != null) {%>
									<img src="layout/img/alcada_nao.png" title="Al&ccedil;ada desbloqueada"/>
								<% } if(model.get('indicaLiberaAvaliacao') == 1 && model.get('indicaLibera') == '1' && model.get('indicaBloqueado') == '0' && model.get('dataDesbloqueio') == null) { %>
									<img src="layout/img/liberacao_nao.png" title="Desbloquear al&ccedil;ada">
								<% } if(model.get('indicaLiberaAvaliacao') == 0 && model.get('indicaLibera') == '1'){ %>
									<img src="layout/img/liberacao.png" title="Avalia&ccedil;&atilde;o liberada">
								<% } if(model.get('indicaBloqueioRendaPresumida') != "N") { %>
									<img src="layout/img/resumida.bmp" title="Conformidade Bloqueada" class="renda-avaliacao" data-codigo="<%= model.get('codigo') %>"/>
								<% } if(model.get('indicaBloqueioRendaPresumida') == "N" && model.get('dataDesbloqueioRendaPresumida') == 1){ %>
									<img src="layout/img/resumida_nao.bmp" title="Conformidade desbloqueada"/>
								<% } if(model.get('indicaBloqueioTomador') == "S") { %>
									<img src="layout/img/tomador_bloqueado.png" title="Avalia&ccedil;&atilde;o Bloqueada" class="tomador-bloqueado" data-codigo="<%= model.get('codigo') %>"/>
								<% } if(model.get('indicaBloqueioTomador') == "N" && model.get('usuarioDesbloqueioTomador') != null){ %>
									<img src="layout/img/tomador_desbloqueado.png" title="Avalia&ccedil;&atilde;o Desbloqueada"/>
								<% } if(model.get('indicaNota') == 1 && model.get('situacao') == 3) { %>
									<img src="layout/img/detalhe._16X16.png" title="Apresentar detalhes" class="item-avaliacao" data-codigo="<%= model.get('codigo') %>"/>
								<% } %>
							</td>
						</tr>
					<% }); %>
				</tbody>
			</table>
		</div>
	</div>
</div>
<div id="divDetalheAvaliacao"></div>
<div id="divItemAvaliacao"></div>